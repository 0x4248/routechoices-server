{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% load hosts %}
{% load markdownify %}
{% load index %}
{% load compress %}

{% block favicon %}{% if club.logo %}<link rel="icon" type="image/png" href="{{club.logo_url}}">{% else %}<link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}?v=20220828">
<link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}?v=20220828">
<link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}?v=20220828">
<link rel="mask-icon" href="{% static 'safari-pinned-tab.svg' %}?v=20220828" color="#5bbad5">
<link rel="manifest" href="{% static 'manifest.json' %}?v=20220828">
<link rel="shortcut icon" href="{% static 'favicon.ico' %}?v=20220828">{% endif %}{% endblock %}

{% block head_title %}GPS Tracking of Events{% if club %} by {{club.name}} | Powered by {{site.name}}{% else %} on {{site.name}}{% endif %}{% endblock %}
{% block head_description %}List of public events{% if club %} by {{club.name}}{% else %} on {{site.name}}, a free and open source live GPS tracking solution for orienteering events.{% endif %}{% endblock %}

{% block extra_head %}
<link rel="alternate" type="application/rss+xml" title="{% if club %}{{club.name}} {% else %}{% endif%}GPS Tracking Event Feed" href="{% if club %}{{event.club.nice_url}}feed{% else %}{% url 'site:events_feed' %}{% endif%}" />
<meta property="og:title" content="GPS Tracking of Events{% if club %} by {{club.name}} | Powered by {{site.name}}{% else %} on {{site.name}}{% endif %}" />
<meta property="og:description" content="List of public events{% if club %} by {{club.name}}{% else %} on {{site.name}}, a free and open source live GPS tracking solution for orienteering events.{% endif %}" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="{{ site.name }}" />
<meta name="twitter:card" content="summary_large_image">{% if not club %}
<meta property="og:image" content="{% static '/img/og.jpg'%}?t=2022091500" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />{% endif %}
{% endblock %}

{% block content %}
{% if club %}
<div class="row">
  <div class="card" style="margin-bottom: 15px;">
    <div class="card-body">
    {{club.description|markdownify }}
    </div>
  </div>
</div>
{% else %}
<div class="row d-none d-sm-block" style="aspect-ratio: 2047 / 768;margin-top:-65px;margin-bottom:20px">
  <h1 style="font-weight: bold;color: white;z-index: 2;margin-left:20px;text-shadow: rgb(0, 0, 0) -1px -1px 0px, rgb(0, 0, 0) 1px -1px 0px, rgb(0, 0, 0) -1px 1px 0px, rgb(0, 0, 0) 1px 1px 0px;font-size: 1.8em;position: relative;top: 80px;line-height:.9em">{{site.name}}<br/><span style="font-size: .6em">Live GPS Tracking Solution</span></h1>
  <img src="{% static 'img/banner.jpg'%}" alt="banner" width="100%" style="border-radius:2em / 1em"></img>
  <div style="text-align: right;padding-right: 26px; font-size:8px;">Photo: Juuso-Valtteri Kivim√§ki</div>
</div>
{% endif %}
<div class="row">
  {% if live_event_sets %}
  <div><h2>Live Events</h2></div>
  <div>
  {% for event_set in live_event_sets %}
    <div class="card" style="margin-bottom: 15px;">
      <div class="card-body">
          {% if not event_set.fake %}<h4 style="font-weight: 700;">{{event_set.name}}</h4>{% if not club %}<div>By {% if event_set.club.logo %}<img src="{{event_set.club.logo_url}}" width="25px" height="25px" alt="logo"/> {% endif %}<a class="link-primary" href="{{ event_set.events.0.club.get_absolute_url }}">{{ event_set.events.0.club.name }}</a></div>{% endif%}<hr/>{% endif%}
          {% for event in event_set.events %}
          <div class="d-flex flex-row bd-highlight justify-content-between">
              <div class="p-2 bd-highlight">
                  <div>
                    <span style="margin-left: 5px;font-style: italic;text-transform:uppercase;" class="badge bg-danger float-end">Live</span>
                    <a class="link-primary" href="{{ event.get_absolute_url }}"><b style="font-size: 1.3em;">{{ event.name }}</b></a>
                  </div>
                  <div>
                    Started <span class="date-utc" data-date="{{ event.start_date|date:'c' }}">{{ event.start_date|date:'Y-m-d H:i' }}</span>
                  </div>
                  {% if not club and event_set.fake%}<div>By {% if event.club.logo %}<img src="{{event.club.logo_url}}" width="25px" height="25px" alt="logo"/> {% endif %}<a class="link-primary" href="{{ event.club.get_absolute_url }}">{{ event.club.name }}</a></div>{% endif%}
              </div>
              <div class="p-2 bd-highlight" style="border-left: 1px solid rgba(0,0,0,.125); width:320px">
                {% if not event.hidden %}<a href="{{event.club.nice_url}}{{event.slug}}/export" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-save"></i> Export</a><br/>{% endif %}
                 {% if event.started and event.allow_route_upload or event.open_registration and not event.ended  %}
                    <a href="{{event.club.nice_url}}{{event.slug}}/contribute" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-circle-plus"></i> Competitor{% if event.open_registration and not event.ended %} registration{% endif %}{% if event.open_registration and event.allow_route_upload and event.started and not event.ended %} or{% endif %}{% if event.started and event.allow_route_upload %} route upload{% endif %}</a><br/>
                {% endif %}
                {% if event.ended and event.map_id %}<a href="http://3drerun.worldofo.com/2d/?server={{ site.domain }}/api/woo&eventid={{event.aid}}&liveid=-" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-external-link" aria-hidden="true"></i> 2DRerun</a>{% endif %}
              </div>
          </div>
          {% if not forloop.last %}<hr/>{% endif%}
          {% endfor %}
      </div>
    </div>
  {% endfor %}
  </div>
  {% endif%}
  {% if event_sets %}
  <div style="margin-bottom: 15px;">
    <h2>Archived Events</h2>
    {% if years %}
      {% if club %}
        {% if years %}
          <div>{% if year %}<a href="{{club.nice_url}}">All</a>{% else %}All{% endif%} {% for y in years %} {% if year == y %}{{ y }}{% else %}<a href="{{club.nice_url}}?year={{ y }}">{{ y }}</a>{% endif %}{% endfor%}</div>
          {% if year %}<div>{% if month %}<a href="{{club.nice_url}}?year={{year}}">All</a>{% else %}All{% endif%} {% for m in months %} {% if month == m %}{{ month_names|index:m }}{% else %}<a href="{{club.nice_url}}?year={{ year }}&month={{m}}">{{ month_names|index:m }}</a>{% endif %}{% endfor%}</div>{% endif %}
        {% endif %}
      {% else %}
        {% if years %}
          <div>{% if year %}<a href="{% url 'site:events_view' %}">All</a>{% else %}All{% endif%} {% for y in years %} {% if year == y %}{{ y }}{% else %}<a href="{% url 'site:events_view' %}?year={{ y }}">{{ y }}</a>{% endif %}{% endfor%}</div>
          {% if year %}<div>{% if month %}<a href="{% url 'site:events_view' %}?year={{year}}">All</a>{% else %}All{% endif%} {% for m in months %} {% if month == m %}{{ month_names|index:m }}{% else %}<a href="{% url 'site:events_view' %}?year={{ year }}&month={{m}}">{{ month_names|index:m }}</a>{% endif %}{% endfor%}</div>{% endif %}
        {% endif %}
      {% endif %}
    {% endif %}
  </div>
  {% endif %}
  <div>
  {% if event_sets.paginator.num_pages > 1 %}{% bootstrap_pagination event_sets extra=request.GET.urlencode %}{% endif %}
  {% for event_set in event_sets %}
    <div class="card" style="margin-bottom: 15px;">
        <div class="card-body">
            {% if not event_set.fake %}<h4 style="font-weight: 700;">{{event_set.name}}</h4>{% if not club %}<div>By {% if event_set.club.logo %}<img src="{{event_set.club.logo_url}}" width="25px" height="25px" alt="logo"/> {% endif %}<a class="link-primary" href="{{ event_set.events.0.club.get_absolute_url }}">{{ event_set.events.0.club.name }}</a></div>{% endif%}<hr/>{% endif%}
            {% for event in event_set.events %}
            <div class="d-flex flex-row bd-highlight justify-content-between">
                <div class="p-2 bd-highlight">
                    <div>
                      <a class="link-primary" href="{{ event.get_absolute_url }}"><b style="font-size: 1.3em;">{{ event.name }}</b></a>{% if event.is_live %}<span style="margin-left: 5px" class="badge bg-danger float-end">LIVE</span>{% endif %}
                    </div>
                    <div>
                      Started <span class="date-utc" data-date="{{ event.start_date|date:'c' }}">{{ event.start_date|date:'Y-m-d H:i' }}</span>
                    </div>
                    {% if not club and event_set.fake %}<div>By {% if event.club.logo %}<img src="{{event.club.logo_url}}" width="25px" height="25px" alt="logo"/> {% endif %}<a class="link-primary" href="{{ event.club.get_absolute_url }}">{{ event.club.name }}</a></div>{% endif%}
                </div>
                <div class="p-2 bd-highlight" style="border-left: 1px solid rgba(0,0,0,.125); width:320px">
                  {% if event.started and event.allow_route_upload or event.open_registration and not event.ended  %}
                      <a href="{{event.club.nice_url}}{{event.slug}}/contribute" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-circle-plus"></i> Competitor{% if event.open_registration and not event.ended %} registration{% endif %}{% if event.open_registration and event.allow_route_upload and event.started and not event.ended %} or{% endif %}{% if event.started and event.allow_route_upload %} route upload{% endif %}</a><br/>
                  {% endif %}
                  {% if not event.hidden %}<a href="{{event.club.nice_url}}{{event.slug}}/export" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-save"></i> Export</a><br/>{% endif %}
                {% if event.ended and event.map_id %}<a href="http://3drerun.worldofo.com/2d/?server={{ site.domain }}/api/woo&eventid={{event.aid}}&liveid=-" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-external-link" aria-hidden="true"></i> 2DRerun</a>{% endif %}
                </div>
            </div>
            {% if not forloop.last %}<hr/>{% endif%}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    {% if event_sets.paginator.num_pages > 1 %}{% bootstrap_pagination event_sets extra=request.GET.urlencode %}{% endif %}
  </div>
  {% if not live_event_sets and not event_sets %}
    <div class="card">
      <div class="card-body">
        <h2 style="color: #888">No public events yet...</h2>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_body %}
{% compress js %}
<script src="{% static '/vendor/umbrella-3.3.0/umbrella.min.js' %}"></script>
<script src="{% static '/vendor/dayjs-1.10.6/dayjs.min.js' %}"></script>
<script src="{% static '/scripts/site/event_list.js' %}"></script>
{% endcompress %}
{% endblock %}
