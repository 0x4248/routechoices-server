{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% load hosts %}
{% load markdownify %}

{% block favicon %}{% if club.logo %}<link rel="icon" type="image/png" href="{{club.nice_url}}logo">{% else %}<link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">
<link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
<link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
<link rel="mask-icon" href="{% static 'safari-pinned-tab.svg' %}" color="#5bbad5">
<link rel="manifest" href="{% static 'manifest.json' %}">
<link rel="shortcut icon" href="{% static 'favicon.ico' %}">{% endif %}{% endblock %}

{% block head_title %}{% if club %}Events by {{club.name}} | Powered by {{site.name}}{% else %}Events on {{site.name}}{% endif %}{% endblock %}

{% block extra_head %}
<link rel="alternate" type="application/rss+xml" title="{% if club %}{{club.name}} Event Feed{% else %}Event Feed{% endif%}" href="{% if club %}{{event.club.nice_url}}feed{% else %}{% url 'site:events_feed' %}{% endif%}" />
{% endblock %}

{% block content %}
{% if club %}
<div class="row">
  {{club.description|markdownify }}  
</div>
<hr/>
{% endif %}
<div class="row">
  {% if live_events %}
  <div><h2>Live</h2></div>
  <div>
  {% for event in live_events %}
    <div class="card" style="margin-bottom: 15px;">
      <div class="card-body">
          <div class="d-flex flex-row bd-highlight justify-content-between">
              <div class="p-2 bd-highlight">
                  <div>
                    <a class="link-primary" href="{{ event.get_absolute_url }}"><b style="font-size: 1.3em;">{{ event.name }}</b></a>{% if event.is_live %} <span class="badge bg-danger pull-right">LIVE</span>{% endif %}
                  </div>
                  <div>
                    Starts <span class="date-utc" data-date="{{ event.start_date|date:'c' }}">{{ event.start_date|date:'Y-m-d H:i' }}</span>
                  </div>
                  {% if not club %}<div>By <a class="link-primary" href="{{ event.club.get_absolute_url }}">{{ event.club.name }}</a></div>{% endif%}
              </div>
              <div class="p-2 bd-highlight" style="border-left: 1px solid rgba(0,0,0,.125); width:320px">
                {% if not event.hidden %}<a href="{{event.club.nice_url}}{{event.slug}}/export" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-save"></i> Export</a>{% endif %}
                {% if event.ended and event.map_id %}<a href="http://3drerun.worldofo.com/2d/?server={{ site.domain }}/api/woo&eventid={{event.aid}}&liveid=-" target="_blank" rel="noreferrer" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-external-link" aria-hidden="true"></i> 2DRerun</a>{% endif %}
                {% if not event.ended and event.open_registration %}<a href="{{event.club.nice_url}}{{event.slug}}/registration" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-plus-circle"></i> Register</a>{% endif %}
                {% if event.started and event.allow_route_upload %}<a href="{{event.club.nice_url}}{{event.slug}}/route_upload" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-upload"></i> Upload Route</a>{% endif %}
              </div>
          </div>
      </div>
    </div>
  {% endfor %}
  </div>
  {% endif%}
  <div>
    {% if club %}
    <h2>All Events by {{ club.name }} <a href="{{event.club.nice_url}}feed"><i class="fa fa-rss"></i></a></h2>
    {% else %}<h2>All Events <a href="{% url 'site:events_feed' %}"><i class="fa fa-rss"></i></a></h2>
    {% endif%}
  </div>

  <div>
  {% for event in events %}
    <div class="card" style="margin-bottom: 15px;">
        <div class="card-body">
            <div class="d-flex flex-row bd-highlight justify-content-between">
                <div class="p-2 bd-highlight">
                    <div>
                      <a class="link-primary" href="{{ event.get_absolute_url }}"><b style="font-size: 1.3em;">{{ event.name }}</b></a>{% if event.is_live %} <span class="badge bg-danger pull-right">LIVE</span>{% endif %}
                    </div>
                    <div>
                      Starts <span class="date-utc" data-date="{{ event.start_date|date:'c' }}">{{ event.start_date|date:'Y-m-d H:i' }}</span>
                    </div>
                    {% if not club %}<div>By <a class="link-primary" href="{{ event.club.get_absolute_url }}">{{ event.club.name }}</a></div>{% endif%}
                </div>
                <div class="p-2 bd-highlight" style="border-left: 1px solid rgba(0,0,0,.125); width:320px">
                  {% if not event.hidden %}<a href="{{event.club.nice_url}}{{event.slug}}/export" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-save"></i> Export</a>{% endif %}
                  {% if not event.ended and event.open_registration %}<a href="{{event.club.nice_url}}{{event.slug}}/registration" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-plus-circle"></i> Register</a>{% endif %}
                  {% if event.started and event.allow_route_upload %}<a href="{{event.club.nice_url}}{{event.slug}}/route_upload" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-upload"></i> Upload Route</a>{% endif %}
                  {% if event.ended and event.map_id %}<a href="http://3drerun.worldofo.com/2d/?server={{ site.domain }}/api/woo&eventid={{event.aid}}&liveid=-" target="_blank" rel="noreferrer" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-external-link" aria-hidden="true"></i> 2DRerun</a>{% endif %}
                </div>
            </div>
        </div>
    </div>
  {% empty %}
    <div class="card">
      <div class="card-body">
        <h2>No public events yet...</h2>
      </div>
    </div>
  {% endfor %}
  </div>
  {% bootstrap_pagination events extra=request.GET.urlencode %}
</div>
{% endblock %}

{% block extra_body %}
<script src="{% static '/vendor/dayjs-1.10.6/dayjs.min.js' %}"></script>
<script src="{% static '/scripts/site/event_list.js' %}?_=2021100100"></script>
{% endblock %}
